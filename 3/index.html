<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, maximum-scale=1, minimum-scale=1, initial-scale=1, user-scalable=no">
	<title>material</title>
	<link type="text/css" rel="stylesheet" href="./libs/google.css" />
	<link type="text/css" rel="stylesheet" href="./libs/materialize/css/materialize.css" media="screen,projection" />
	<link type="text/css" rel="stylesheet" href="./index.css" />
	<script src="./libs/jquery-2.1.1.min.js"></script>
	<script src="./libs/materialize/js/materialize.min.js"></script>
</head>

<body>
	<div id="app">
		<div id="content">
			<div class="navbar-fixed">
				<nav class="light-blue">
					<div class="nav-wrapper">
						<a href="#!" class="left-align">首页</a>
						<ul class="right">
							<li><a href="#" class="waves-effect waves-light"><i class="material-icons">notifications</i></a></li>
							<li><a href="#" class="waves-effect waves-light"><i class="material-icons">refresh</i></a></li>
							<li><a class="dropdown-button waves-effect waves-light" href="#!" data-activates="dropdown1"><i class="material-icons">more_vert</i></a></li>
						</ul>

						<a href="#" data-activates="slide-out" class="waves-effect waves-light button-collapse"><i class="material-icons">menu</i></a>
					</div>
				</nav>
			</div>
			<ul id="dropdown1" class="dropdown-content z-depth-5">
				<li><a href="#" style="color: #000">夜间模式</a></li>
				<!--<li class="divider"></li>-->
				<li><a href="#" style="color: #000">设置选项</a></li>
			</ul>
			<ul id="slide-out" class="side-nav">
				<!--<li>
					<div class="userView">
						<div class="background">
							<img src="http://materializecss.com/images/yuna.jpg">
						</div>
						<a href="#!user"><img class="circle" src="http://materializecss.com/images/yuna.jpg"></a>
						<a href="#!name"><span class="white-text name">John Doe</span></a>
						<a href="#!email"><span class="white-text email">jdandturk@gmail.com</span></a>
					</div>
				</li>-->
				<li class="light-blue">
					<a class="waves-effect waves-light">
						<img class="circle" src="https://avatars3.githubusercontent.com/u/9670320">
						<span class="color-white">fengnovo</span>
					</a>
				</li>
				<li class="light-blue">
					<a class="waves-effect waves-light i-b">
						<span class="color-white"><i class="material-icons">star</i>我的收藏</span>
					</a>
					<a class="waves-effect waves-light i-b">
						<span class="color-white"><i class="material-icons">file_download</i>离线下载</span>
					</a>
				</li>
				<li><a class="waves-effect">
					<span class="color-blue"><i class="material-icons">home</i>首页</a></span>
				</li>
				<li><a class="waves-effect">日常心理学</a></li>
				<li><a class="waves-effect">用户推荐日报</a></li>
				<li><a class="waves-effect">电影日报</a></li>
				<li><a class="waves-effect">不许无聊</a></li>
				<li><a class="waves-effect">设计日报</a></li>
				<li><a class="waves-effect">大公司日报</a></li>
				<li><a class="waves-effect">财经日报</a></li>
				<li><a class="waves-effect">互联网安全</a></li>
				<li><a class="waves-effect">开始游戏</a></li>
				<li><a class="waves-effect">音乐日报</a></li>
				<li><a class="waves-effect">动漫日报</a></li>
				<li><a class="waves-effect">体育日报</a></li>
			</ul>
			<div class="slider">
				<ul class="slides">
					
					<!--<li>
						<img src="http://lorempixel.com/580/250/nature/2">
						<div class="caption left-align">
							<h5 class="light grey-text text-lighten-3 banner-text">深圳下暴雨，早上带伞了</h5>
						</div>
					</li>
					<li>
						<img src="http://lorempixel.com/580/250/nature/3">
						<div class="caption right-align">
							<h5 class="light grey-text text-lighten-3 banner-text">吃早餐了吗？</h5>
						</div>
					</li>
					<li>
						<img src="http://lorempixel.com/580/250/nature/4">
						<div class="caption center-align">
							<h5 class="light grey-text text-lighten-3 banner-text">今天新闻是啥呢，会不会有好的项目呢</h5>
						</div>
					</li>-->
				</ul>
			</div>
			<div id="container">
				<ul id="list">
					
				</ul>
			</div>
		</div>
	</div>
	<script>
		$(function () {
			var zhihuData = {};
			if (sessionStorage.getItem('zhihu')) {
				zhihuData = JSON.parse(sessionStorage.getItem('zhihu'));
			}

			$(".button-collapse").sideNav();
			
			var date = 20170520, isCalling = false;
			function s() {
				$(window).unbind('scroll').bind('scroll', function () {
					//下面这句主要是获取网页的总高度，主要是考虑兼容性所以把Ie支持的documentElement也写了，这个方法至少支持IE8  
					var htmlHeight = document.body.scrollHeight || document.documentElement.scrollHeight;
					//clientHeight是网页在浏览器中的可视高度，  
					var clientHeight = document.body.clientHeight || document.documentElement.clientHeight;
					//scrollTop是浏览器滚动条的top位置，  
					var scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
					//通过判断滚动条的top位置与可视网页之和与整个网页的高度是否相等来决定是否加载内容； 
					console.log(scrollTop,clientHeight,htmlHeight); 
					// if (scrollTop + clientHeight == htmlHeight) {
					if (scrollTop / htmlHeight > 0.6) {
						// console.log('00');
						if (!isCalling) {
							date -= 1;
							callAjax();
						}

					}
				})
			}

			function callAjax() {
				isCalling = true;
				if (zhihuData[date]) {
					var li = '';
					zhihuData[date].forEach(function (item) {
						// li += ('<li><a href="./detail.html?id=' + item.id + '">' + '<img src=' + item.images[0] + ' alt=""/>' + item.title + '</a></li>')
						li+= '<li class="p-5 waves-effect c-radius z-depth-1">'
								+'	<a href="./detail.html?id=' + item.id + '">'
								+'		<p class="m-r-1">' + item.title + '</p>'
								+'		<img src=' + item.images[0] + ' alt="">'
								+'	</a>'
								+'</li>';
					})
					$('#list').append(li);
					isCalling = false;
					s();
					return
				}
				$.ajax({
					url: 'http://111.230.139.105/api/zhihu/news/before/' + date,
					success: function (data) {
						console.log(data)
						zhihuData[date] = data.stories;
						sessionStorage.setItem('zhihu', JSON.stringify(zhihuData));
						var li = '';
						data.stories.forEach(function (item) {
							// li += ('<li><a href="./detail.html?id=' + item.id + '">' + '<img src=' + item.images[0] + ' alt=""/>' + item.title + '</a></li>')
							li+= '<li class="p-5 waves-effect c-radius z-depth-1">'
								+'	<a href="./detail.html?id=' + item.id + '">'
								+'		<p class="m-r-1">' + item.title + '</p>'
								+'		<img src=' + item.images[0] + ' alt="">'
								+'	</a>'
								+'</li>';
						})
						$('#list').append(li);
						// var options = [ {
						// 	selector: '#list', 
						// 	offset: 50, 
						// 	callback: function(el) { 
						// 		// Materialize.toast("This is our ScrollFire Demo!", 1500 ); 
						// 	}
						// }, {
						// 	selector: '#list', 
						// 	offset: 205, 
						// 	callback: function(el) { 
						// 		// Materialize.toast("Please continue scrolling!", 1500 ); 
						// 	} 
						// }, {
						// 	selector: '#list', 
						// 	offset: 400, 
						// 	callback: function(el) { 
						// 		Materialize.showStaggeredList($(el)); 
						// 	} 
						// }, {
						// 	selector: '#list', 
						// 	offset: 500, 
						// 	callback: function(el) { 
						// 		Materialize.fadeInImage($(el)); 
						// 	} 
						// }];
						// Materialize.scrollFire(options);
						isCalling = false;
						s();
					},
					error: function (data) {
						console.log(data)
					}
				})
			}
			//首次请求
			$.ajax({
				url: 'http://111.230.139.105/api/zhihu//news/latest',
				success: function (data) {
					console.log(data)
					zhihuData[date] = data.stories;
					sessionStorage.setItem('zhihu', JSON.stringify(zhihuData));
					var banners='',li = '';
					data.top_stories.forEach(function (item) {
						banners+= '<li><a href="./detail.html?id='+item.id+'">'
							+'<img src=' + item.image + ' alt="" />'
							+'<div class="caption center-align">'
							+'<h5 class="light grey-text text-lighten-3 banner-text">' + item.title + '</h5>'
							+'</div></a>'
							+'</li>';
					});
					$('.slides').html(banners);
					$('.slider').slider({
						height: '14rem'
					});
					data.stories.forEach(function (item) {
						li+= '<li class="p-5 waves-effect c-radius z-depth-1">'
							+'	<a href="./detail.html?id=' + item.id + '">'
							+'		<p class="m-r-1">' + item.title + '</p>'
							+'		<img src=' + item.images[0] + ' alt="">'
							+'	</a>'
							+'</li>';
					});
					$('#list').append(li);
					isCalling = false;
					s();
				},
				error: function (data) {
					console.log(data)
				}
			});

		})
	</script>
</body>

</html>